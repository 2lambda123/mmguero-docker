version: '3.7'

x-process-variables: &process-variables
  # docker containers will run processes as unprivileged user with UID:GID
  PUSER_PRIV_DROP : "false"
  PUID : 1000
  PGID : 1000

services:
  wireproxy:
    build:
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/mmguero/wireproxy:latest
    container_name: wireproxy
    environment:
      << : *process-variables
      WIREPROXY_CONFIG_FROM_ENVS : 'true'
    volumes:
      - ./config.env.local:/etc/wireproxy/config.env:ro
    env_file:
      - wireproxy.env
    ports:
      - "127.0.0.1:11080:11080"
    restart: "no"
